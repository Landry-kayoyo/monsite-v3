{% extends 'pages/base.html' %}
{% block content %}
<div class="container py-5">
    <!-- En-tête avec animation -->
    <div class="hero-header bg-gradient-dark text-white py-5 mb-5 rounded-4 overflow-hidden position-relative">
        <div class="container position-relative z-index-1 py-4 text-center">
            <h1 class="display-4 fw-bold mb-3 animate__animated animate__fadeInDown">Nos Solutions Expertes</h1>
            <p class="lead mb-4 mx-auto animate__animated animate__fadeIn animate__delay-1s" style="max-width: 600px;">Découvrez une gamme de services sur-mesure pour transformer vos ambitions en réalité</p>
            <div class="divider mx-auto bg-white opacity-25 animate__animated animate__fadeIn animate__delay-2s" style="height: 2px; width: 100px;"></div>
        </div>
        <div class="position-absolute top-0 end-0 w-100 h-100 overflow-hidden opacity-10">
            <div class="particles"></div>
        </div>
    </div>
    <!-- Grille optimisée avec lazy loading et intersection observer -->
    <div class="row g-4" id="services-grid">
        {% for service in services %}
        <div class="col-xl-4 col-md-6 service-item">
            <div class="card border-0 overflow-hidden hover-card h-100">
                <!-- Image avec lazy loading et placeholder -->
                <div class="image-wrapper position-relative">
                    <img src="{% if forloop.first %}{{ service.image_principale.url }}{% else %}data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 4 3'%3E%3C/svg%3E{% endif %}"
                         data-src="{{ service.image_principale.url }}"
                         class="card-img-top service-img lazyload"
                         alt="{{ service.titre }}"
                         width="400"
                         height="300">
                    <div class="color-overlay bg-gradient-primary"></div>
                    <div class="image-description position-absolute start-0 bottom-0 p-4 w-100 text-white">
                        <p class="mb-0 description-text">{{ service.Description|truncatechars:150 }}</p>
                    </div>
                    <div class="service-badge position-absolute top-0 end-0 m-3 bg-primary text-white rounded-pill px-3 py-1 small fw-bold">
                        {{ forloop.counter|stringformat:"02d" }}
                    </div>
                </div>
              
                <!-- Contenu de carte -->
                <div class="card-body p-4 bg-white">
                    <div class="service-icon mb-3 text-primary">
                        <i class="{{ service.icon|default:'fas fa-lightbulb' }} fa-2x"></i>
                    </div>
                    <h3 class="h4 fw-bold mb-3 text-dark">{{ service.titre }}</h3>
                    <ul class="service-features list-unstyled mb-4">
                        {% for feature in service.key_features|slice:":3" %}
                        <li class="mb-2">
                            <i class="fas fa-check-circle text-success me-2"></i>
                            {{ feature }}
                        </li>
                        {% endfor %}
                    </ul>
                    <a href="{% url 'service_detail' service.pk %}" class="btn btn-outline-primary px-0 fw-bold stretched-link">
                        Explorer ce service
                        <i class="fas fa-arrow-right ms-2 align-middle"></i>
                    </a>
                </div>
            </div>
        </div>
        {% empty %}
        <div class="col-12">
            <div class="empty-state text-center py-5 animate__animated animate__fadeIn">
                <div class="empty-state-icon bg-light rounded-circle d-inline-flex align-items-center justify-content-center mb-4" style="width: 100px; height: 100px;">
                    <i class="fas fa-box-open fa-3x text-muted"></i>
                </div>
                <h3 class="h4 mb-3 text-dark">En cours de préparation</h3>
                <p class="text-muted mx-auto" style="max-width: 500px;">Nos experts finalisent des solutions innovantes qui seront disponibles très prochainement.</p>
                <a href="{% url 'contact' %}" class="btn btn-primary mt-3">Être notifié</a>
            </div>
        </div>
        {% endfor %}
    </div>
    <!-- CTA avec formulaire intégré -->
    <div class="cta-section bg-gradient-primary text-white rounded-4 p-4 p-lg-5 mt-5 position-relative overflow-hidden">
        <div class="position-absolute top-0 end-0 w-100 h-100 overflow-hidden opacity-10">
            <div class="particles"></div>
        </div>
        <div class="row align-items-center position-relative">
            <div class="col-lg-7 mb-4 mb-lg-0">
                <h3 class="h2 fw-bold mb-3">Prêt à transformer votre projet ?</h3>
                <p class="mb-4 opacity-75">Contactez-nous pour une consultation gratuite et sans engagement.</p>
                <ul class="list-unstyled mb-0">
                    <li class="mb-2"><i class="fas fa-check-circle me-2"></i> Analyse gratuite de vos besoins</li>
                    <li class="mb-2"><i class="fas fa-check-circle me-2"></i> Devis personnalisé sous 48h</li>
                    <li><i class="fas fa-check-circle me-2"></i> Premier conseil sans engagement</li>
                </ul>
            </div>
            <div class="col-lg-5">
                <form class="cta-form bg-white rounded-3 p-4 shadow">
                    <div class="mb-3">
                        <input type="text" class="form-control" placeholder="Votre nom" required>
                    </div>
                    <div class="mb-3">
                        <input type="email" class="form-control" placeholder="Votre email" required>
                    </div>
                    <div class="mb-3">
                        <select class="form-select">
                            <option selected disabled>Service intéressé</option>
                            {% for service in services %}
                            <option>{{ service.titre }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary w-100 fw-bold py-2">
                        <i class="fas fa-paper-plane me-2"></i> Envoyer la demande
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>
<style>
    /* Animation et effets */
    @keyframes float {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-10px); }
    }
   
    .particles {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-image: url("data:image/svg+xml,%3Csvg width='20' height='20' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='10' cy='10' r='1' fill='%23ffffff' fill-opacity='0.2'/%3E%3C/svg%3E");
        animation: float 6s ease-in-out infinite;
    }
   
    .service-item {
        opacity: 0;
        transform: translateY(20px);
        transition: opacity 0.6s ease-out, transform 0.6s ease-out;
    }
   
    .service-item.visible {
        opacity: 1;
        transform: translateY(0);
    }
   
    /* Styles optimisés */
    .hero-header {
        background: linear-gradient(135deg, #2c3e50 0%, #1a2533 100%);
        min-height: 300px;
        display: flex;
        align-items: center;
        position: relative;
        overflow: hidden;
    }
   
    .hover-card {
        transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        border-radius: 16px !important;
        border: 1px solid rgba(0,0,0,0.05);
    }
   
    .hover-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 12px 28px rgba(0,0,0,0.12);
        border-color: rgba(75,108,183,0.2);
    }
   
    .image-wrapper {
        overflow: hidden;
        border-radius: 16px 16px 0 0;
        height: 220px;
        position: relative;
    }
   
    .service-img {
        transition: transform 0.8s cubic-bezier(0.16, 1, 0.3, 1);
        height: 100%;
        object-fit: cover;
        width: 100%;
        will-change: transform;
    }
   
    .hover-card:hover .service-img {
        transform: scale(1.1);
    }
   
    .color-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        opacity: 0;
        transition: opacity 0.6s ease;
        background: linear-gradient(45deg, rgba(75,108,183,0.4) 0%, rgba(240, 72, 72, 0.3) 100%);
    }
   
    .image-description {
        background: linear-gradient(to top, rgba(0,0,0,0.9) 0%, transparent 100%);
        transform: translateY(100%);
        transition: all 0.6s cubic-bezier(0.23, 1, 0.32, 1);
        opacity: 0;
        padding: 1.5rem;
    }
   
    .description-text {
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
        text-overflow: ellipsis;
        max-height: 4.5em;
        line-height: 1.5;
        font-size: 0.95rem;
    }
   
    .hover-card:hover .color-overlay,
    .hover-card:hover .image-description {
        opacity: 1;
        transform: translateY(0);
    }
   
    .bg-gradient-primary {
        background: linear-gradient(135deg, #4b6cb7 0%, #182848 100%);
    }
   
    .bg-gradient-dark {
        background: linear-gradient(135deg, #2c3e50 0%, #1a2533 100%);
    }
   
    .service-icon {
        transition: all 0.4s ease;
        display: inline-block;
    }
   
    .hover-card:hover .service-icon {
        transform: scale(1.1) rotate(5deg);
        color: #4b6cb7 !important;
    }
   
    .service-badge {
        transform: translateY(-20px);
        opacity: 0;
        transition: all 0.4s ease;
    }
   
    .hover-card:hover .service-badge {
        transform: translateY(0);
        opacity: 1;
    }
   
    .cta-form {
        transform: translateY(0);
        transition: transform 0.4s ease;
    }
   
    .cta-section:hover .cta-form {
        transform: translateY(-5px);
    }
   
    /* Responsive */
    @media (max-width: 992px) {
        .hero-header {
            min-height: 250px;
        }
       
        .image-wrapper {
            height: 180px;
        }
    }
   
    @media (max-width: 768px) {
        .hero-header {
            min-height: 220px;
            padding: 2.5rem 0;
        }
       
        .image-wrapper {
            height: 160px;
        }
       
        .cta-section .row {
            flex-direction: column-reverse;
        }
       
        .description-text {
            -webkit-line-clamp: 2;
            font-size: 0.85rem;
        }
    }
</style>
<script>
    // Intersection Observer pour les animations
    document.addEventListener('DOMContentLoaded', function() {
        // Animation des services
        const serviceItems = document.querySelectorAll('.service-item');
        const servicesGrid = document.getElementById('services-grid');
       
        const observer = new IntersectionObserver((entries) => {
            entries.forEach((entry, index) => {
                if (entry.isIntersecting) {
                    setTimeout(() => {
                        entry.target.classList.add('visible');
                    }, index * 100);
                }
            });
        }, { threshold: 0.1 });
       
        serviceItems.forEach(item => observer.observe(item));
       
        // Lazy loading des images
        if ('loading' in HTMLImageElement.prototype) {
            const images = document.querySelectorAll('img.lazyload');
            images.forEach(img => {
                img.src = img.dataset.src;
            });
        } else {
            // Fallback pour les navigateurs ne supportant pas le lazy loading natif
            const lazyLoadInstance = new LazyLoad({
                elements_selector: ".lazyload",
                threshold: 100
            });
        }
       
        // Effet parallax pour le hero
        const heroHeader = document.querySelector('.hero-header');
        if (heroHeader) {
            window.addEventListener('scroll', function() {
                const scrollPosition = window.pageYOffset;
                heroHeader.style.backgroundPositionY = scrollPosition * 0.5 + 'px';
            });
        }
    });
</script>
{% endblock %}